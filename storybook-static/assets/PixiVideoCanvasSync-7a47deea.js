import{j as R}from"./jsx-runtime-4ca860c5.js";import{r as n}from"./index-61bf1805.js";import{G as he,u as $,g as O,a as Q,m as x,E as B,i as Ee}from"./PixiStage-ce27c430.js";import{w as X,a as Z}from"./withFiltersHook-489645a6.js";import{d as F}from"./debounce-9a7f49c6.js";const ee=(d,E,g,c)=>{const o=n.useCallback(F(d,c),[d,c]),b=n.useCallback(F(E,c),[E,c]),P=n.useCallback(F(g,c),[g,c]),h=n.useCallback(()=>{o()},[o]),e=n.useCallback(()=>{b()},[b]),r=n.useCallback(()=>{P()},[P]);return{onPointerOver:h,onPointerDown:e,onPointerOut:r}},Ae={isPlaying:!1,progress:0,speed:1,isMuted:!1,isWaiting:!1,isStalled:!1,loaded:!1,size:{width:50,height:50},isDragging:!1,timeDiff:0},G=n.forwardRef((d,E)=>{const[g,c]=n.useState(0),[o,b]=n.useState(),P=n.useRef(null),h=n.useRef(null),e=n.useRef(null),r=n.useRef(Ae),u=n.useRef(),{uniqueId:m,mute:l=!1,src:A,startAt:C,endAt:I,frameStartAt:a,frameEndAt:p,visible:_,disabled:L,transformation:{x:k,y:M,width:U,height:j,animation:H,colorCorrection:w={}},pointerdown:D=()=>{},pointerout:W=()=>{},pointerover:K=()=>{},fps:N=0}=d,{tl:s,dragModeRef:T,isRemotion:f}=n.useContext(he),{onPointerDown:re,onPointerOut:te,onPointerOver:ne}=ee(K,D,W,1),{blurRadius:ue=0,vignette:ie=0,noise:ae=0}=w,{temperatureFilter:oe,sharpnessFilter:se,hueFilter:le,blurFilter:de,adjustmentFilter:ce,vignetteFilter:me,noiseFilter:pe}=X(w),z=A||"",Y=n.useMemo(()=>{const t=document.createElement("video");return t.src=A,t.crossOrigin="Anonymus",t.autoplay=!1,t.currentTime=a===0?.001:a,t},[A,a]);$(B.PAUSE,()=>{e.current&&(e.current.pause(),r.current.isPlaying=!1)}),$(B.SCRUBBER_CLICKED,()=>{e.current&&(e.current.pause(),r.current.isPlaying=!1)}),$(B.REVERSE_MODE_END,()=>{e.current&&(e.current.pause(),r.current.isPlaying=!1)});const J=n.useCallback(F(()=>{if(e.current){const t=e.current;t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA&&e.current.pause(),r.current.isPlaying=!1}},400),[e]);n.useEffect(()=>{e.current&&!f?(T.current?(J(),r.current.isPlaying=!1,r.current.isDragging=!0):r.current.isDragging=!1,e.current.muted=l):r.current.isDragging=!1,r.current.isMuted=l},[l,T,J,e]);const fe=t=>{if(e.current){if(e.current.currentTime=Number(t),!T.current){const i=e.current,y=i.currentTime>0&&!i.paused&&!i.ended&&i.readyState>i.HAVE_CURRENT_DATA;s.current&&s.current.isActive()&&u.current&&u.current.isActive()&&(y||e.current.play(),r.current.isPlaying=!0,c(q=>q+1))}r.current.progress=0}},ye=()=>{if(e.current){const t=e.current;t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>t.HAVE_CURRENT_DATA&&e.current.pause(),r.current.isPlaying=!1,u.current&&(r.current.progress=u.current.progress())}},ve=()=>{},ge=()=>{var t,i;if(u.current&&(r.current.progress=u.current.progress()),e.current&&u.current){const y=a+((t=u==null?void 0:u.current)==null?void 0:t.time()),q=Math.abs(e.current.currentTime-y),V=e.current,S=V.currentTime>0&&!V.paused&&!V.ended&&V.readyState>V.HAVE_CURRENT_DATA;T.current?(e.current.currentTime=y,setTimeout(()=>{e.current&&e.current.play().then(()=>{r.current.isPlaying=!1,e.current&&e.current.pause()})},100),r.current.isPlaying=!1):(S!==r.current.isPlaying||!S)&&r.current.progress>.01&&r.current.progress<.99?(i=s.current)!=null&&i.isActive()&&u.current&&u.current.isActive()&&(S||e.current.play(),r.current.isPlaying=!0):q>.3&&r.current.progress>.01&&r.current.progress<.99&&(e.current.currentTime=y)}};return n.useEffect(()=>{let t=O.context(()=>{});if(h.current&&s.current){const i={duration:Number(p)-Number(a),onStart:fe,onComplete:ye,onStartParams:[a,p],onCompleteParams:[],onInterrupt:ve,onUpdate:ge,onUpdateParams:[a,p],onPause:()=>{console.log("onPause video sprite pause",m)},onResume:()=>{console.log("onResume video sprite resume",m)},onReverseComplete:()=>{console.log("onReverseComplete video sprite reverse complete",m)},onKill:()=>{console.log("onKill video sprite kill",m)}};t=O.context(()=>{u.current=O.from(h.current,i,a),s.current.add(u.current,C)})}return()=>{u.current&&(u.current.kill(),O.killTweensOf(u.current)),t.revert()}},[H,C,I,a,p]),n.useEffect(()=>{e.current&&(e.current.muted=l,r.current.isMuted=l);const t=setTimeout(()=>{e.current&&(e.current.muted=l,r.current.isMuted=l)},1500);return()=>{clearTimeout(t)}},[l]),n.useEffect(()=>{const t=Math.round((Number(a)+Number.EPSILON)*100)/100,i=function(){e.current&&(e.current.currentTime=t,e.current.muted=l)},y=function(){if(e.current){const v=e.current;v.currentTime>0&&!v.paused&&!v.ended&&v.readyState>v.HAVE_CURRENT_DATA&&e.current.pause()}r.current.isWaiting=!1,r.current.isStalled=!1},q=function(){e.current&&e.current.pause(),r.current.isWaiting=!0,r.current.isStalled=!1},V=function(){r.current.isWaiting=!1,r.current.isStalled=!1},S=function(){r.current.isWaiting=!1,r.current.isStalled=!0},be=Math.round((Number(a)+Number.EPSILON)*100)/100,Ve=Math.round((Number(p)+Number.EPSILON)*100)/100,Pe=`${z}#t=${be},${Ve}`;return Q.fromLoader(Y,Pe,m,{pixiIdPrefix:m,resourceOptions:{autoPlay:!1,crossorigin:"Anonymus",updateFPS:N?Math.max(120,Number(N)):30}}).then(v=>{v&&(b(v),e.current=v.baseTexture.resource.source,e.current.id=m,e.current.addEventListener("loadedmetadata",i),e.current.addEventListener("ended",y),e.current.addEventListener("loadstart",q),e.current.addEventListener("canplaythrough",V),e.current.addEventListener("stalled",S))}),()=>{e.current&&(e.current.pause(),e.current.removeEventListener("loadedmetadata",i),e.current.removeEventListener("ended",y),e.current.removeEventListener("loadstart",q),e.current.removeEventListener("canplaythrough",V),e.current.removeEventListener("stalled",S))}},[z,m,a,p,Y]),n.useEffect(()=>{const t=setTimeout(()=>{o&&u.current&&s.current&&u.current.progress()<.1&&e.current&&!u.current.isActive()&&!f&&e.current.play().then(()=>{r.current.isPlaying=!1,e.current&&e.current.pause()})},30);return()=>{clearTimeout(t)}},[o]),n.useEffect(()=>{s.current&&!s.current.isActive()&&!f&&(r.current.isPlaying=!1,e.current&&e.current.pause());const t=setTimeout(()=>{if(o&&s.current&&g>0&&!f){s.current.isActive()||(r.current.isPlaying=!1,e.current&&e.current.pause());const i=e.current;i&&s.current.isActive()&&u.current&&u.current.isActive()&&(i.currentTime>0&&!i.paused&&!i.ended&&i.readyState>i.HAVE_CURRENT_DATA||e.current.play(),r.current.isPlaying=!0)}},10);return()=>{clearTimeout(t)}},[g,o]),R.jsx(Z,{...d,ref:E,ignoreTlForVideo:!0,pointerdown:re,pointerover:ne,pointerout:te,children:R.jsx(x.Container,{ref:h,children:o&&R.jsx(x.Sprite,{texture:o,width:U,height:j,anchor:.5,x:k,y:M,ref:P,alpha:_?1:0,...!L&&_&&{interactive:!0,pointerdown:D},filters:[oe,se,le,ce,...ue>0?[de]:[],...ie>0?[me]:[],...ae>0?[pe]:[]]})})})});G.whyDidYouRender={logOnDifferentValues:!0,customName:"PixiVideoSprite"};try{G.displayName="PixiVideoSprite",G.__docgenInfo={description:"",displayName:"PixiVideoSprite",props:{uniqueId:{defaultValue:null,description:"",name:"uniqueId",required:!0,type:{name:"string"}},src:{defaultValue:null,description:"",name:"src",required:!0,type:{name:"string"}},frameStartAt:{defaultValue:null,description:"",name:"frameStartAt",required:!0,type:{name:"number"}},frameEndAt:{defaultValue:null,description:"",name:"frameEndAt",required:!0,type:{name:"number"}},mute:{defaultValue:null,description:"",name:"mute",required:!0,type:{name:"boolean"}},locked:{defaultValue:null,description:"",name:"locked",required:!0,type:{name:"boolean"}},pointerdown:{defaultValue:null,description:"",name:"pointerdown",required:!1,type:{name:"(() => void)"}},pointerup:{defaultValue:null,description:"",name:"pointerup",required:!1,type:{name:"(() => void)"}},mousedown:{defaultValue:null,description:"",name:"mousedown",required:!1,type:{name:"(() => void)"}},mouseup:{defaultValue:null,description:"",name:"mouseup",required:!1,type:{name:"(() => void)"}},pointerover:{defaultValue:null,description:"",name:"pointerover",required:!1,type:{name:"(() => void)"}},mouseover:{defaultValue:null,description:"",name:"mouseover",required:!1,type:{name:"(() => void)"}},mouseout:{defaultValue:null,description:"",name:"mouseout",required:!1,type:{name:"(() => void)"}},applyTransformer:{defaultValue:null,description:"",name:"applyTransformer",required:!1,type:{name:"boolean"}},onAnchorTransformationEnd:{defaultValue:null,description:"",name:"onAnchorTransformationEnd",required:!1,type:{name:"((endData: any) => void)"}},path:{defaultValue:null,description:"",name:"path",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!1,type:{name:"string"}},startAt:{defaultValue:null,description:"",name:"startAt",required:!0,type:{name:"number"}},endAt:{defaultValue:null,description:"",name:"endAt",required:!0,type:{name:"number"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},isDragging:{defaultValue:null,description:"",name:"isDragging",required:!1,type:{name:"boolean"}},transformation:{defaultValue:null,description:"",name:"transformation",required:!0,type:{name:"{ x: number; y: number; width: number; height: number; anchor: number; rotation?: number | undefined; alpha?: number | undefined; scale?: number | [number, number] | undefined; tint?: number | undefined; ... 4 more ...; overlay?: OverlayTypes | undefined; }"}},pointerout:{defaultValue:null,description:"",name:"pointerout",required:!1,type:{name:"(() => void)"}},fps:{defaultValue:null,description:"",name:"fps",required:!1,type:{name:"number"}}}}}catch{}n.forwardRef((d,E)=>{const[g,c]=n.useState(),o=n.useRef(null),b=n.useRef(null),{visible:P,disabled:h,transformation:{x:e,y:r,width:u,height:m,colorCorrection:l={}},pointerdown:A=()=>{},pointerout:C=()=>{},pointerover:I=()=>{},canvasImageRef:a}=d,p=a&&(a==null?void 0:a.getCanvas()),_=x.useApp(),{onPointerDown:L,onPointerOut:k,onPointerOver:M}=ee(I,A,C,1),{blurRadius:U=0,vignette:j=0,noise:H=0}=l,{temperatureFilter:w,sharpnessFilter:D,hueFilter:W,blurFilter:K,adjustmentFilter:N,vignetteFilter:s,noiseFilter:T}=X(l);return x.useTick(()=>{if(o.current&&o.current.texture){const f=o.current.texture.baseTexture;f&&f.update(),b.current&&_.renderer.render(b.current)}}),n.useEffect(()=>{if(!Ee(p)){const f=Q.from(p);c(f)}},[p]),R.jsx(Z,{...d,ref:E,ignoreTlForVideo:!0,pointerdown:L,pointerover:M,pointerout:k,children:R.jsx(x.Container,{ref:b,children:g&&R.jsx(x.Sprite,{texture:g,width:u,height:m,anchor:.5,x:e,y:r,ref:o,alpha:P?1:0,...!h&&P&&{interactive:!0,pointerdown:A},filters:[w,D,W,N,...U>0?[K]:[],...j>0?[s]:[],...H>0?[T]:[]]})})})});try{PixiVideoCanvasSync.displayName="PixiVideoCanvasSync",PixiVideoCanvasSync.__docgenInfo={description:"",displayName:"PixiVideoCanvasSync",props:{uniqueId:{defaultValue:null,description:"",name:"uniqueId",required:!0,type:{name:"string"}},src:{defaultValue:null,description:"",name:"src",required:!0,type:{name:"string"}},frameStartAt:{defaultValue:null,description:"",name:"frameStartAt",required:!0,type:{name:"number"}},frameEndAt:{defaultValue:null,description:"",name:"frameEndAt",required:!0,type:{name:"number"}},mute:{defaultValue:null,description:"",name:"mute",required:!0,type:{name:"boolean"}},locked:{defaultValue:null,description:"",name:"locked",required:!0,type:{name:"boolean"}},pointerdown:{defaultValue:null,description:"",name:"pointerdown",required:!1,type:{name:"(() => void)"}},pointerup:{defaultValue:null,description:"",name:"pointerup",required:!1,type:{name:"(() => void)"}},mousedown:{defaultValue:null,description:"",name:"mousedown",required:!1,type:{name:"(() => void)"}},mouseup:{defaultValue:null,description:"",name:"mouseup",required:!1,type:{name:"(() => void)"}},pointerover:{defaultValue:null,description:"",name:"pointerover",required:!1,type:{name:"(() => void)"}},mouseover:{defaultValue:null,description:"",name:"mouseover",required:!1,type:{name:"(() => void)"}},mouseout:{defaultValue:null,description:"",name:"mouseout",required:!1,type:{name:"(() => void)"}},applyTransformer:{defaultValue:null,description:"",name:"applyTransformer",required:!1,type:{name:"boolean"}},onAnchorTransformationEnd:{defaultValue:null,description:"",name:"onAnchorTransformationEnd",required:!1,type:{name:"((endData: any) => void)"}},canvasImageRef:{defaultValue:null,description:"",name:"canvasImageRef",required:!1,type:{name:"CanvasImageProps"}},path:{defaultValue:null,description:"",name:"path",required:!1,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!1,type:{name:"string"}},startAt:{defaultValue:null,description:"",name:"startAt",required:!0,type:{name:"number"}},endAt:{defaultValue:null,description:"",name:"endAt",required:!0,type:{name:"number"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},isDragging:{defaultValue:null,description:"",name:"isDragging",required:!1,type:{name:"boolean"}},transformation:{defaultValue:null,description:"",name:"transformation",required:!0,type:{name:"{ x: number; y: number; width: number; height: number; anchor: number; rotation?: number | undefined; alpha?: number | undefined; scale?: number | [number, number] | undefined; tint?: number | undefined; ... 4 more ...; overlay?: OverlayTypes | undefined; }"}},pointerout:{defaultValue:null,description:"",name:"pointerout",required:!1,type:{name:"(() => void)"}},fps:{defaultValue:null,description:"",name:"fps",required:!1,type:{name:"number"}}}}}catch{}export{G as P,ee as u};
//# sourceMappingURL=PixiVideoCanvasSync-7a47deea.js.map
