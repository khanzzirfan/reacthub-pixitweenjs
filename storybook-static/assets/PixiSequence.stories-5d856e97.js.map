{"version":3,"file":"PixiSequence.stories-5d856e97.js","sources":["../../src/utils/AppStateSequenceProvider.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport useDeepEffect from \"./useDeepEffect\";\r\nimport { TransformationEnd } from \"../types/transformation\";\r\nimport { GsapPixieContext } from \"../providers/GsapPixieContextProvider\";\r\nimport gsap from \"gsap\";\r\nimport \"@pixi/gif\";\r\n\r\ninterface AppState {\r\n  transformation: {\r\n    [key: string]: unknown;\r\n  };\r\n}\r\n\r\ninterface AppStateContextProviderProps extends AppState {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const AppStateSequenceProvider: React.FC<\r\n  AppStateContextProviderProps\r\n> = ({ children, ...props }) => {\r\n  console.log(\"AppStateContextProvider\", props);\r\n  const [mouseOverSprite, setMouseOverSprite] = React.useState<boolean>(false);\r\n\r\n  const appStateRef = React.useRef<AppState>(props);\r\n\r\n  //// Context\r\n  const { tl } = React.useContext(GsapPixieContext);\r\n\r\n  useDeepEffect(() => {\r\n    appStateRef.current = props;\r\n    // @ts-ignore\r\n    const { startAt, endAt } = props;\r\n    const duration = endAt - startAt;\r\n    console.log(\"AppStateContextProvider useDeepEffect\", props);\r\n    const ctx = gsap.context(() => {\r\n      if (tl.current) {\r\n        // add tween to timeline\r\n        tl.current.to(appStateRef.current, { duration: duration }, 0);\r\n      }\r\n    });\r\n    return () => ctx.revert();\r\n  }, [props]);\r\n\r\n  const onAnchorTransformationEnd = React.useCallback(\r\n    (data: TransformationEnd) => {\r\n      console.log(\"onAnchorTransformationEnd\", data);\r\n      const { transformation } = data;\r\n      const newAppState = {\r\n        ...appStateRef.current,\r\n        transformation: {\r\n          ...appStateRef.current?.transformation,\r\n          ...transformation,\r\n        },\r\n      };\r\n      console.log(\"saving state\", newAppState);\r\n      appStateRef.current = newAppState;\r\n    },\r\n    []\r\n  );\r\n\r\n  const onMouseOverSprite = React.useCallback(() => {\r\n    setMouseOverSprite(true);\r\n  }, []);\r\n\r\n  const onMouseOutSprite = React.useCallback(() => {\r\n    setMouseOverSprite(false);\r\n  }, []);\r\n\r\n  const onClickSprite = React.useCallback(() => {}, []);\r\n\r\n  const onTextUpdate = React.useCallback((data: any) => {\r\n    console.log(\"onTextUpdate\", data);\r\n  }, []);\r\n\r\n  const onExitQuillEditor = React.useCallback(() => {\r\n    console.log(\"onExitQuillEditor\");\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      {/*@ts-ignore */}\r\n      {React.cloneElement(children, {\r\n        ...appStateRef.current,\r\n        onAnchorTransformationEnd,\r\n        onMouseOverSprite,\r\n        onClickSprite,\r\n        pointerdown: onClickSprite,\r\n        pointerover: onMouseOverSprite,\r\n        pointerout: onMouseOutSprite,\r\n        mouseOverSprite,\r\n        onTextUpdate,\r\n        onExitQuillEditor,\r\n      })}\r\n    </>\r\n  );\r\n};\r\n"],"names":["AppStateSequenceProvider","children","props","mouseOverSprite","setMouseOverSprite","React.useState","appStateRef","React.useRef","tl","React.useContext","GsapPixieContext","useDeepEffect","startAt","endAt","duration","ctx","gsap","onAnchorTransformationEnd","React.useCallback","data","transformation","newAppState","_a","onMouseOverSprite","onMouseOutSprite","onClickSprite","onTextUpdate","onExitQuillEditor","jsx","Fragment","React.cloneElement"],"mappings":"2rBAiBO,MAAAA,EAAA,CAAA,CAAA,SAAAC,EAAA,GAAAC,CAAA,IAAA,CAGL,QAAA,IAAA,0BAAAA,CAAA,EACA,KAAA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAA,EAAA,EAEAC,EAAAC,SAAAL,CAAA,EAGA,CAAA,GAAAM,CAAA,EAAAC,EAAA,WAAAC,CAAA,EAEAC,EAAA,IAAA,CACEL,EAAA,QAAAJ,EAEA,KAAA,CAAA,QAAAU,EAAA,MAAAC,CAAA,EAAAX,EACAY,EAAAD,EAAAD,EACA,QAAA,IAAA,wCAAAV,CAAA,EACA,MAAAa,EAAAC,EAAA,QAAA,IAAA,CACER,EAAA,SAEEA,EAAA,QAAA,GAAAF,EAAA,QAAA,CAAA,SAAAQ,CAAA,EAAA,CAAA,CACF,CAAA,EAEF,MAAA,IAAAC,EAAA,QAAwB,EAAA,CAAAb,CAAA,CAAA,EAG1B,MAAAe,EAAAC,EAAA,YAAwCC,GAAA,OAEpC,QAAA,IAAA,4BAAAA,CAAA,EACA,KAAA,CAAA,eAAAC,CAAA,EAAAD,EACAE,EAAA,CAAoB,GAAAf,EAAA,QACH,eAAA,CACC,IAAAgB,EAAAhB,EAAA,UAAA,YAAAgB,EAAA,eACU,GAAAF,CACrB,CACL,EAEF,QAAA,IAAA,eAAAC,CAAA,EACAf,EAAA,QAAAe,CAAsB,EACxB,CAAA,CACC,EAGHE,EAAAL,EAAAA,YAAA,IAAA,CACEd,EAAA,EAAA,CAAuB,EAAA,CAAA,CAAA,EAGzBoB,EAAAN,EAAAA,YAAA,IAAA,CACEd,EAAA,EAAA,CAAwB,EAAA,CAAA,CAAA,EAG1BqB,EAAAP,EAAAA,YAAA,IAAA,CAA8C,EAAA,CAAA,CAAA,EAE9CQ,EAAAR,cAAAC,GAAA,CACE,QAAA,IAAA,eAAAA,CAAA,CAAgC,EAAA,CAAA,CAAA,EAGlCQ,EAAAT,EAAAA,YAAA,IAAA,CACE,QAAA,IAAA,mBAAA,CAA+B,EAAA,CAAA,CAAA,EAGjC,OAAAU,EAAA,IAAAC,EAAA,SAAA,CAAA,SAAAC,EAAAA,aAAA7B,EAAA,CAGkC,GAAAK,EAAA,QACb,0BAAAW,EACf,kBAAAM,EACA,cAAAE,EACA,YAAAA,EACa,YAAAF,EACA,WAAAC,EACD,gBAAArB,EACZ,aAAAuB,EACA,kBAAAC,CACA,CAAA,CAAA,CAAA,CAIR;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}