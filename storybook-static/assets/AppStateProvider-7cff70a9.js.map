{"version":3,"file":"AppStateProvider-7cff70a9.js","sources":["../../src/utils/AppStateProvider.tsx"],"sourcesContent":["import * as React from \"react\";\nimport useDeepEffect from \"./useDeepEffect\";\nimport { TransformationEnd } from \"../types/transformation\";\nimport { action } from \"@storybook/addon-actions\";\nimport \"@pixi/gif\";\n\ninterface AppState {\n  transformation: {\n    [key: string]: unknown;\n  };\n}\n\ninterface AppStateContextProviderProps extends AppState {\n  children: React.ReactNode;\n}\n\nexport const AppStateContextProvider: React.FC<\n  AppStateContextProviderProps\n> = ({ children, ...props }) => {\n  console.log(\"AppStateContextProvider\", props);\n  /// const [mouseOverSprite, setMouseOverSprite] = React.useState<boolean>(false);\n  const [counter, setCounter] = React.useState<number>(0);\n\n  const appStateRef = React.useRef<AppState>(props);\n\n  useDeepEffect(() => {\n    console.log(\"useDeepEffect\", props);\n    appStateRef.current = props;\n    setCounter((prev) => prev + 1);\n  }, [props]);\n\n  const onAnchorTransformationEnd = React.useCallback(\n    (data: TransformationEnd) => {\n      console.log(\"onAnchorTransformationEnd\", data);\n      const { transformation } = data;\n      const newAppState = {\n        ...appStateRef.current,\n        transformation: {\n          ...appStateRef.current?.transformation,\n          ...transformation,\n        },\n      };\n      console.log(\"saving state\", newAppState);\n      appStateRef.current = newAppState;\n      setCounter((prev) => prev + 1);\n    },\n    []\n  );\n\n  const onMouseOverSprite = React.useCallback(() => {\n    action(\"onMouseOverSprite\")();\n    // setMouseOverSprite(true);\n  }, []);\n\n  const onMouseOutSprite = React.useCallback(() => {\n    action(\"onMouseOutSprite\")();\n    // setMouseOverSprite(false);\n  }, []);\n\n  const onClickSprite = React.useCallback(() => {\n    action(\"onClickSprite\")();\n  }, []);\n\n  const onTextUpdate = React.useCallback((data: any) => {\n    action(\"onTextUpdate\")(data);\n    console.log(\"onTextUpdate\", data);\n    const newAppState = {\n      ...appStateRef.current,\n      text: data.text,\n      transformation: {\n        ...appStateRef.current?.transformation,\n      },\n    };\n    appStateRef.current = newAppState;\n    setCounter((prev) => prev + 1);\n  }, []);\n\n  const onExitQuillEditor = React.useCallback(() => {\n    action(\"onExitQuillEditor\")();\n    console.log(\"onExitQuillEditor\");\n  }, []);\n\n  return (\n    <>\n      {/*@ts-ignore */}\n      {React.cloneElement(children, {\n        ...appStateRef.current,\n        onAnchorTransformationEnd,\n        onMouseOverSprite,\n        onClickSprite,\n        pointerdown: onClickSprite,\n        pointerover: onMouseOverSprite,\n        pointerout: onMouseOutSprite,\n        onTextUpdate,\n        onExitQuillEditor,\n        datatestid: counter,\n      })}\n    </>\n  );\n};\n"],"names":["AppStateContextProvider","children","props","counter","setCounter","React.useState","appStateRef","React.useRef","useDeepEffect","prev","onAnchorTransformationEnd","React.useCallback","data","transformation","newAppState","_a","onMouseOverSprite","action","onMouseOutSprite","onClickSprite","onTextUpdate","onExitQuillEditor","jsx","Fragment","React.cloneElement"],"mappings":"+KAgBO,MAAAA,EAAA,CAAA,CAAA,SAAAC,EAAA,GAAAC,CAAA,IAAA,CAGL,QAAA,IAAA,0BAAAA,CAAA,EAEA,KAAA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAA,CAAA,EAEAC,EAAAC,SAAAL,CAAA,EAEAM,EAAA,IAAA,CACE,QAAA,IAAA,gBAAAN,CAAA,EACAI,EAAA,QAAAJ,EACAE,EAAAK,GAAAA,EAAA,CAAA,CAA6B,EAAA,CAAAP,CAAA,CAAA,EAG/B,MAAAQ,EAAAC,EAAA,YAAwCC,GAAA,OAEpC,QAAA,IAAA,4BAAAA,CAAA,EACA,KAAA,CAAA,eAAAC,CAAA,EAAAD,EACAE,EAAA,CAAoB,GAAAR,EAAA,QACH,eAAA,CACC,IAAAS,EAAAT,EAAA,UAAA,YAAAS,EAAA,eACU,GAAAF,CACrB,CACL,EAEF,QAAA,IAAA,eAAAC,CAAA,EACAR,EAAA,QAAAQ,EACAV,EAAAK,GAAAA,EAAA,CAAA,CAA6B,EAC/B,CAAA,CACC,EAGHO,EAAAL,EAAAA,YAAA,IAAA,CACEM,EAAA,mBAAA,GAA4B,EAAA,CAAA,CAAA,EAI9BC,EAAAP,EAAAA,YAAA,IAAA,CACEM,EAAA,kBAAA,GAA2B,EAAA,CAAA,CAAA,EAI7BE,EAAAR,EAAAA,YAAA,IAAA,CACEM,EAAA,eAAA,GAAwB,EAAA,CAAA,CAAA,EAG1BG,EAAAT,cAAAC,GAAA,OACEK,EAAA,cAAA,EAAAL,CAAA,EACA,QAAA,IAAA,eAAAA,CAAA,EACA,MAAAE,EAAA,CAAoB,GAAAR,EAAA,QACH,KAAAM,EAAA,KACJ,eAAA,CACK,IAAAG,EAAAT,EAAA,UAAA,YAAAS,EAAA,cACU,CAC1B,EAEFT,EAAA,QAAAQ,EACAV,EAAAK,GAAAA,EAAA,CAAA,CAA6B,EAAA,CAAA,CAAA,EAG/BY,EAAAV,EAAAA,YAAA,IAAA,CACEM,EAAA,mBAAA,IACA,QAAA,IAAA,mBAAA,CAA+B,EAAA,CAAA,CAAA,EAGjC,OAAAK,EAAA,IAAAC,EAAA,SAAA,CAAA,SAAAC,EAAAA,aAAAvB,EAAA,CAGkC,GAAAK,EAAA,QACb,0BAAAI,EACf,kBAAAM,EACA,cAAAG,EACA,YAAAA,EACa,YAAAH,EACA,WAAAE,EACD,aAAAE,EACZ,kBAAAC,EACA,WAAAlB,CACY,CAAA,CAAA,CAAA,CAIpB"}